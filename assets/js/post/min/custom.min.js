$(document).ready(function(){function t(){u||(requestAnimationFrame(e),u=!0)}function e(){var t=i.getBoundingClientRect().top+window.scrollY,e=i.offsetHeight+35,o=d-r;s>=t+e?(l.classList.add("floating-active"),a.unpause()):(l.classList.remove("floating-active"),a.pause());for(var n=0;n<v.length;n++){var f=n+1===v.length,$=m[n],g=f?1/0:m[n+1];$<s&&s<=g?n<v.length-1?(h[n].classList.add("active"),p.innerText=v[n].innerText,a.unpause()):(a.pause(),p.innerText="推荐阅读"):n<v.length-1&&h[n].classList.remove("active")}c.setAttribute("max",o),c.setAttribute("value",s),u=!1}$(".post-full-content").fitVids();var o=!(null===navigator.userAgent.match(/(iPhone|iPad|iPod|Android|ios|SymbianOS)/i));$("pre code").each(function(t,e){var n=$(this).text().split("\n").length-1,a=$("<ul/>").addClass("number");for($(this).parent().append(a),t=1;t<=n;t++)a.append($("<li/>").text(t));$(e).attr("class")&&$(e).attr("class",$(e).attr("class").replace("language-","")),$(e.parentNode).attr("class",$(e).attr("class")),o?$(e).addClass("hljs"):hljs.highlightBlock(e)}),$(".post-full-content p").each(function(t,e){if(e.innerHTML.match(/\$\S+\$/)){var o=document.createElement("script");o.src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS_HTML";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(o,n);var a=document.createElement("script");a.type="text/x-mathjax-config",a.innerText='MathJax.Hub.Config({tex2jax: {inlineMath: [["$","$"]]}});',o.parentNode.insertBefore(a,o)}});var n=function(){var t=!1,e=!1,o=function(){$(".toc li").each(function(o,n){t||e?!t&&e?$(n).hasClass("toc-level-H2")?$(n).attr("class","toc-link toc-level-H1"):$(n).attr("class","toc-link toc-level-H2"):t&&!e&&$(n).hasClass("toc-level-H3")&&$(n).attr("class","toc-link toc-level-H2"):$(n).attr("class","toc-link toc-level-H1")})};$(".toc li").each(function(n,a){$(a).hasClass("toc-level-H1")?t=!0:$(a).hasClass("toc-level-H2")&&(e=!0),n===$(".toc li").length-1&&(console.log(n),console.log("H1"+t),console.log("H2"+e),o())})};$(".post-full-content h1,.post-full-content h2,.post-full-content h3").each(function(t,e){$(e).attr("id",e.innerText.replace(/[#<>.\s]/g,"_")),$(e).attr("class","header-link"),$(".toc").append('<li class="toc-link toc-level-'+e.tagName+'" ><span id='+$(e).attr("id")+"> "+e.innerText+"</span></li>"),t===$(".post-full-content h1,.post-full-content h2,.post-full-content h3").length-1&&n()});var a=function(){var t=!1,e=!1,o=!1,n=!1,a=($(".toc"),function(){$("div.toc").hasClass("active")&&($("div.toc").removeClass("active"),$(".floating-header-toc span#open").addClass("active"),$(".floating-header-toc span#close").removeClass("active"))}),c=function(){$("div.toc").hasClass("active")||($("div.toc").addClass("active"),$(".floating-header-toc span#open").removeClass("active"),$(".floating-header-toc span#close").addClass("active"))},l=function(){$("div.toc");e?(t=!1,$(".floating-header-toc .box").removeClass("hold"),setTimeout(function(){e=!1},400),a()):(e=!0,t=!0,c(),$(".floating-header-toc .box").addClass("hold"))};return{close:function(){e||(t=!1,n=!1,toc_timer=setTimeout(function(){!1===n&&a()},100))},open:function(){e||(t=!0,n=!0,c())},hold:l,pause:function(){t&&e&&(o=!0,l())},unpause:function(){o&&!t&&l(),o=!1}}}();if(o?($(".floating-header-toc .box").css("background","none"),$(".floating-header-toc .box span#title").text("目录"),$(".floating-header-toc").css("max-width","none"),$(".floating-header-toc").css("min-width","none"),$(".site-header").css("display","none")):($(".floating-header-toc .box").mouseover(function(t){a.open()}),$(".floating-header-toc .box").mouseout(function(t){a.close()}),$(".toc").mouseover(function(){a.open()}),$(".toc").mouseout(function(){a.close()})),$(".toc").click(function(t){var e=$(t.target).attr("id");e&&window.scrollTo(0,$("#"+e).offset().top-40)}),$(".floating-header-toc .box").click(function(){a.hold()}),o)$(".floating-header").addClass("floating-active");else{var c=document.querySelector("progress"),l=document.querySelector(".floating-header"),i=document.querySelector(".post-full-title"),s=window.scrollY,r=window.innerHeight,d=$(document).height(),u=!1,h=document.querySelectorAll(".toc-link"),f=document.querySelectorAll(".header-link"),p=document.querySelector(".floating-header-toc #title"),g=document.querySelector(".post-full-footer"),v=[];f.forEach(function(t,e){v.push(t)}),v.push(g);var m=[];v.forEach(function(t,e){m.push(t.getBoundingClientRect().top+window.scrollY-60)}),m.push(g.getBoundingClientRect().top),window.addEventListener("scroll",function(){s=window.scrollY,t()},{passive:!0}),window.addEventListener("resize",function(){r=window.innerHeight,d=$(document).height(),$(document).width()<=800&&$(".site-header").css("display","block"),t()},!1),e()}});