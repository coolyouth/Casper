$(document).ready(function(){function t(){r||requestAnimationFrame(e),r=!0}function e(){var t=c.getBoundingClientRect().top+window.scrollY,e=c.offsetHeight+35,d=l-s;i>=t+e?(a.classList.add("floating-active"),o.unpause()):(a.classList.remove("floating-active"),o.pause());for(var h=0;h<p.length;h++){var $=h+1===p.length,g=v[h],m=$?1/0:v[h+1];g<i&&i<=m?h<p.length-1?(u[h].classList.add("active"),f.innerText=p[h].innerText,o.unpause()):(o.pause(),f.innerText="推荐阅读"):h<p.length-1&&u[h].classList.remove("active")}n.setAttribute("max",d),n.setAttribute("value",i),r=!1}$(".post-full-content").fitVids(),$("pre code").each(function(t,e){var o=$(this).text().split("\n").length-1,n=$("<ul/>").addClass("number");for($(this).parent().append(n),t=1;t<=o;t++)n.append($("<li/>").text(t));$(e).attr("class")&&$(e).attr("class",$(e).attr("class").replace("language-","")),$(e.parentNode).attr("class",$(e).attr("class")),hljs.highlightBlock(e)}),$(".post-full-content p").each(function(t,e){if(e.innerHTML.match(/\$\S+\$/)){var o=document.createElement("script");o.src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS_HTML";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(o,n);var a=document.createElement("script");a.type="text/x-mathjax-config",a.innerText='MathJax.Hub.Config({tex2jax: {inlineMath: [["$","$"]]}});',o.parentNode.insertBefore(a,o)}}),$(".post-full-content h1,.post-full-content h2,.post-full-content h3").each(function(t,e){$(e).attr("id",e.innerText.replace(/[#<>.\s]/g,"_")),$(e).attr("class","header-link"),$(".toc").append('<li class="toc-link toc-level-'+e.tagName+'" ><span id='+$(e).attr("id")+"> "+e.innerText+"</span></li>")});var o=function(){var t=!1,e=!1,o=!1,n=!1,a=$(".toc"),c=function(){$("div.toc").hasClass("active")&&($("div.toc").removeClass("active"),$(".floating-header-toc span#open").addClass("active"),$(".floating-header-toc span#close").removeClass("active"))},i=function(){$("div.toc").hasClass("active")||($("div.toc").addClass("active"),$(".floating-header-toc span#open").removeClass("active"),$(".floating-header-toc span#close").addClass("active"))};return{close:function(){o||e||(t=!1,n=!1,toc_timer=setTimeout(function(){!1===n&&c()},100))},open:function(){o||e||(t=!0,n=!0,i())},hold:function(){o||($("div.toc"),e?(t=!1,$(".floating-header-toc .box").removeClass("hold"),setTimeout(function(){e=!1},400),c()):(e=!0,t=!0,i(),$(".floating-header-toc .box").addClass("hold")))},pause:function(){o=!0,t&&a.removeClass("active")},unpause:function(){o=!1,t&&a.addClass("active")}}}();$(".floating-header-toc .box").mouseover(function(t){o.open()}),$(".floating-header-toc .box").mouseout(function(t){o.close()}),$(".toc").mouseover(function(){o.open()}),$(".toc").mouseout(function(){o.close()}),$(".toc").click(function(t){var e=$(t.target).attr("id");e&&window.scrollTo(0,$("#"+e).offset().top-40)}),$(".floating-header-toc .box").click(function(){o.hold()});var n=document.querySelector("progress"),a=document.querySelector(".floating-header"),c=document.querySelector(".post-full-title"),i=window.scrollY,s=window.innerHeight,l=$(document).height(),r=!1,u=document.querySelectorAll(".toc-link"),d=document.querySelectorAll(".header-link"),f=document.querySelector(".floating-header-toc #title"),h=document.querySelector(".post-full-footer"),p=[];d.forEach(function(t,e){p.push(t)}),p.push(h);var v=[];p.forEach(function(t,e){v.push(t.getBoundingClientRect().top+window.scrollY-60)}),v.push(h.getBoundingClientRect().top),window.addEventListener("scroll",function(){i=window.scrollY,t()},{passive:!0}),window.addEventListener("resize",function(){s=window.innerHeight,l=$(document).height(),t()},!1),e()});