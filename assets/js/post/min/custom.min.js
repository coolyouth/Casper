$(document).ready(function(){function t(){x===w.length-1?p[x-1].classList.remove("active"):p[x].classList.remove("active")}function e(){x>=w.length?x=w.length-1:x<0&&(x=0),x===w.length-1?(i.pause(),g.innerText="推荐阅读"):x===w.length-2?(p[x].classList.add("active"),g.innerText=w[x].innerText,i.unpause()):(p[x].classList.add("active"),g.innerText=w[x].innerText)}function n(){f||(requestAnimationFrame(o),f=!0)}function o(){var n=r.getBoundingClientRect().top+window.scrollY,o=r.offsetHeight+35,a=h-d;u>=n+o?(s.classList.add("floating-active"),i.unpause()):(s.classList.remove("floating-active"),i.pause());var c=function(t){return t>=w.length?1/0:C[t]},$=function(t){return t<=-1?0:C[t]};if($(x)<u&&u<=c(x+1))e();else if($(x+1)<u&&u<=c(x+2))t(),x++,e();else if($(x-1)<u&&u<=c(x))t(),x--,e();else{console.log("not found");for(var v=0;v<w.length;v++){var m=v+1===w.length,T=C[v],b=m?1/0:C[v+1];T<u&&u<=b?(x=v,v<w.length-1?(p[v].classList.add("active"),g.innerText=w[v].innerText,i.unpause()):(i.pause(),g.innerText="推荐阅读")):v<w.length-1&&p[v].classList.remove("active")}}l.setAttribute("max",a),l.setAttribute("value",u),f=!1}$(".post-full-content").fitVids();var a=!(null===navigator.userAgent.match(/(iPhone|iPad|iPod|Android|ios|SymbianOS)/i));$("pre code").each(function(t,e){var n=$(this).text().split("\n").length-1,o=$("<ul/>").addClass("number");for($(this).parent().append(o),t=1;t<=n;t++)o.append($("<li/>").text(t));$(e).attr("class")&&$(e).attr("class",$(e).attr("class").replace("language-","")),$(e.parentNode).attr("class",$(e).attr("class")),a?$(e).addClass("hljs"):hljs.highlightBlock(e)}),$(".post-full-content p").each(function(t,e){if(e.innerHTML.match(/\$\S+\$/)){var n=document.createElement("script");n.src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS_HTML";var o=document.getElementsByTagName("script")[0];o.parentNode.insertBefore(n,o);var a=document.createElement("script");a.type="text/x-mathjax-config",a.innerText='MathJax.Hub.Config({tex2jax: {inlineMath: [["$","$"]]}});',n.parentNode.insertBefore(a,n)}});var c=function(){var t=!1,e=!1,n=function(){$(".toc li").each(function(n,o){t||e?!t&&e?$(o).hasClass("toc-level-H2")?$(o).attr("class","toc-link toc-level-H1"):$(o).attr("class","toc-link toc-level-H2"):t&&!e&&$(o).hasClass("toc-level-H3")&&$(o).attr("class","toc-link toc-level-H2"):$(o).attr("class","toc-link toc-level-H1")})};$(".toc li").each(function(o,a){$(a).hasClass("toc-level-H1")?t=!0:$(a).hasClass("toc-level-H2")&&(e=!0),o===$(".toc li").length-1&&n()})};$(".post-full-content h1,.post-full-content h2,.post-full-content h3").each(function(t,e){$(e).attr("id",e.innerText.replace(/[#<>.\s]/g,"_")),$(e).attr("class","header-link"),$(".toc").append('<li class="toc-link toc-level-'+e.tagName+'" ><span id='+$(e).attr("id")+"> "+e.innerText+"</span></li>"),t===$(".post-full-content h1,.post-full-content h2,.post-full-content h3").length-1&&c()});var i=function(){var t=!1,e=!1,n=!1,o=!1,a=($(".toc"),function(){$("div.toc").hasClass("active")&&($("div.toc").removeClass("active"),$(".floating-header-toc span#open").addClass("active"),$(".floating-header-toc span#close").removeClass("active"))}),c=function(){$("div.toc").hasClass("active")||($("div.toc").addClass("active"),$(".floating-header-toc span#open").removeClass("active"),$(".floating-header-toc span#close").addClass("active"))},i=function(){$("div.toc");e?(t=!1,$(".floating-header-toc .box").removeClass("hold"),setTimeout(function(){e=!1},400),a()):(e=!0,t=!0,c(),$(".floating-header-toc .box").addClass("hold"))};return{close:function(){e||(t=!1,o=!1,toc_timer=setTimeout(function(){!1===o&&a()},100))},open:function(){e||(t=!0,o=!0,c())},hold:i,pause:function(){!n&&t&&e&&(n=!0,i())},unpause:function(){!n||t||e||(n=!1,i())}}}();if(a?($(".floating-header-toc .box").css("background","none"),$(".floating-header-toc .box span#title").text("目录"),$(".floating-header-toc").css("max-width","none"),$(".floating-header-toc").css("min-width","none"),$(".site-header").css("display","none")):($(".floating-header-toc .box").mouseover(function(t){i.open()}),$(".floating-header-toc .box").mouseout(function(t){i.close()}),$(".toc").mouseover(function(){i.open()}),$(".toc").mouseout(function(){i.close()})),$(".toc").click(function(t){var e=$(t.target).attr("id");e&&window.scrollTo(0,$("#"+e).offset().top-40)}),$(".floating-header-toc .box").click(function(){i.hold()}),a)$(".floating-header").addClass("floating-active");else{var l=document.querySelector("progress"),s=document.querySelector(".floating-header"),r=document.querySelector(".post-full-title"),u=window.scrollY,d=window.innerHeight,h=$(document).height(),f=!1,p=document.querySelectorAll(".toc-link"),v=document.querySelectorAll(".header-link"),g=document.querySelector(".floating-header-toc #title"),m=document.querySelector(".post-full-footer"),x=0,w=[];v.forEach(function(t,e){w.push(t)}),w.push(m);var C=[];w.forEach(function(t,e){C.push(t.getBoundingClientRect().top+window.scrollY-60)}),C.push(m.getBoundingClientRect().top),window.addEventListener("scroll",function(){u=window.scrollY,n()},{passive:!0}),window.addEventListener("resize",function(){d=window.innerHeight,h=$(document).height(),$(document).width()<=800&&$(".site-header").css("display","block"),n()},!1),o()}});